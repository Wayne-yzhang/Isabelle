theory 
  DMZDatatype
  imports 
    "../../UPF-Firewall"
begin
  
  
datatype Adr = Intranet | Internet | Mail | Web | DMZ
instance Adr::adr ..
type_synonym port = int
type_synonym Networks = "Adr \<times> port"

definition
  intranet::"Networks net" where
  "intranet = {{(a,b). a= Intranet}}"
definition
  dmz :: "Networks net" where
  "dmz = {{(a,b). a= DMZ}}"
definition
  mail :: "Networks net" where
  "mail = {{(a,b). a=Mail}}" 
definition
  web :: "Networks net" where
  "web = {{(a,b). a=Web}}" 
definition
  internet :: "Networks net" where 
  "internet = {{(a,b). a= Internet}}"
  
definition 
  Intranet_mail_port :: "(Networks ,DummyContent) FWPolicy" where
  "Intranet_mail_port = (allow_from_ports_to {21::port,14} intranet mail)" 
  
definition
  Intranet_Internet_port :: "(Networks,DummyContent) FWPolicy" where
  "Intranet_Internet_port = allow_from_ports_to {80::port,90} intranet internet"
  
definition
  Internet_web_port :: "(Networks,DummyContent) FWPolicy" where
  "Internet_web_port = (allow_from_ports_to {80::port,90} internet web)"
  
definition
  Internet_mail_port :: "(Networks,DummyContent) FWPolicy" where
  "Internet_mail_port =  (allow_all_from_port_to internet (21::port) dmz)"
  
definition 
  policyPort :: "(Networks, DummyContent) FWPolicy" where
  "policyPort = deny_all ++ 
                  Intranet_Internet_port ++ 
                  Intranet_mail_port ++  
                  Internet_mail_port ++ 
                  Internet_web_port"


definition
  not_in_same_net :: "(Networks,DummyContent) packet \<Rightarrow> bool" where
  "not_in_same_net x  =  ((src x \<sqsubset> internet \<longrightarrow> \<not> dest x \<sqsubset> internet) \<and> 
                        (src x \<sqsubset> intranet \<longrightarrow> \<not> dest x \<sqsubset> intranet) \<and> 
                        (src x \<sqsubset> dmz \<longrightarrow> \<not> dest x \<sqsubset> dmz))"
  
lemmas PolicyLemmas =   dmz_def internet_def intranet_def mail_def web_def 
  Internet_web_port_def Internet_mail_port_def
  Intranet_Internet_port_def Intranet_mail_port_def 
  src_def dest_def src_port dest_port in_subnet_def
  
  
end
