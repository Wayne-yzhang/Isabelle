theory Residual_Graph
imports Network
begin

  flow can be effectively pushed along or reverse to a network edge,
  by increasing or decreasing the flow on that edge:\<close>
text \<open>The edges of the residual graph are either parallel or reverse 
  to the edges of the network.\<close>
text \<open>Let's fix a network with a preflow @{term f} on it\<close>
  text \<open>We abbreviate the residual graph by @{term cf}.\<close>
subsection \<open>Properties\<close>
text \<open>The nodes of the residual graph are exactly the nodes of the network.\<close>
          unfolding residualGraph_def using \<open>(u, v) \<in> E\<close> by (auto simp:)
        then have "cf (u, v) \<noteq> 0" using \<open>(u, v) \<in> E\<close> unfolding E_def by auto
          using \<open>(u, v) \<in> E\<close> no_parallel_edge by auto
        then have "cf (v, u) \<noteq> 0" using \<open>f (u, v) \<noteq> 0\<close> by auto
          unfolding residualGraph_def using \<open>(v, u) \<in> E\<close> by (auto)
        then have "cf (v, u) \<noteq> 0" using \<open>(v, u) \<in> E\<close> unfolding E_def by auto
          using \<open>(v, u) \<in> E\<close> no_parallel_edge by auto
        then have "cf (u, v) \<noteq> 0" using \<open>f (v, u) \<noteq> 0\<close> by auto
text \<open>Note, that Isabelle is powerful enough to prove the above case 
  distinctions completely automatically, although it takes some time:\<close>
text \<open>As the residual graph has the same nodes as the network, it is also finite:\<close>
text \<open>The capacities on the edges of the residual graph are non-negative\<close>
text \<open>Again, there is an automatic proof\<close>
text \<open>All edges of the residual graph are labeled with positive capacities:\<close>
text \<open>Nodes with positive excess must have an outgoing edge in the 
  residual graph. 

  Intuitively: The excess flow must come from somewhere.\<close>
end \<comment> \<open>Network with preflow\<close>
locale RPreGraph \<comment> \<open>Locale that characterizes a residual graph of a network\<close>
locale RGraph \<comment> \<open>Locale that characterizes a residual graph of a network\<close>
text \<open>The value of the flow can be computed from the residual graph.\<close>
end \<comment> \<open>Network with Flow\<close>
end \<comment> \<open>Theory\<close>
